FROM ansibleplaybookbundle/apb-base:release-1.2

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLXYyLWFwYgpkZXNjcmlwdGlv\
bjogQVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgdjIgdmVy\
c2lvbiBvZiBDbG91ZC1OYXRpdmUgV29ya3Nob3Agb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmlu\
ZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCm1ldGFkYXRhOgog\
IGRlcGVuZGVuY2llczogW10KICBkaXNwbGF5TmFtZTogIkNsb3VkLU5hdGl2ZSBXb3Jrc2hvcCBJ\
bnN0YWxsZXIgdjIiCiAgbG9uZ0Rlc2NyaXB0aW9uOiAiSW5zdGFsbHMgdGhlIGxhYiBpbnN0cnVj\
dGlvbnMgYW5kIHJlcXVpcmVkIGNvbXBvbmVudHMgKEdpdCBzZXJ2ZXIsIE5leHVzLCBFY2xpcHNl\
IENoZSwgZXRjKSBmb3IgcnVubmluZyB0aGUgQ2xvdWQtTmF0aXZlIFdvcmtzaG9wIGh0dHBzOi8v\
Z2l0aHViLmNvbS9SZWRIYXQtTWlkZGxld2FyZS1Xb3Jrc2hvcHMvY2xvdWQtbmF0aXZlLXdvcmtz\
aG9wLXYyLWd1aWRlcyIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6ICJwZmljb24g\
cGZpY29uLXByb2Nlc3MtYXV0b21hdGlvbiIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVkIEhh\
dCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVwbG95\
cyBDbG91ZC1OYXRpdmUgV29ya3Nob3AgdjIgSW5mcmFzdHJ1Y3R1cmUKICAgIGZyZWU6IFRydWUK\
ICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgcGFyYW1ldGVyczoK\
ICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJuYW1lCiAgICAgIGRl\
c2NyaXB0aW9uOiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0IGFkbWluIHJl\
c291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlz\
cGxheV9ncm91cDogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3Bh\
c3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogUGFzc3dvcmQg\
aXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3VyY2VzCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3\
b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAgICAtIG5hbWU6\
IG9wZW5zaGlmdF9tYXN0ZXJfdXJsCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgTWFzdGVyIFVSTAog\
ICAgICBkZXNjcmlwdGlvbjogVGhlIGFkZHJlc3MgdG8gT3BlblNoaWZ0IG1hc3RlciBVUkwgdG8g\
YmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAgIHR5cGU6\
IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHN0cmluZwog\
ICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXJf\
cGFzc3dvcmQKICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBhc3N3b3JkCiAgICAgIGRlc2Ny\
aXB0aW9uOiBUaGUgT3BlblNoaWZ0IHBhc3N3b3JkIGZvciBwYXJ0aWNpcGFudHMgdG8gYmUgZGlz\
cGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHN0cmluZwogICAgICB2\
YWx1ZTogIm9wZW5zaGlmdCIKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRlCiAgICAtIG5h\
bWU6IGluZnJhc3Zjc19hZG1fdXNlcgogICAgICB0aXRsZTogSW5mcmEgU2VydmljZXMgQWRtaW4g\
VXNlcgogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgaW5mcmFzdHJ1Y3R1cmUgc2Vy\
dmljZXMgKEdvZ3MsIENoZSwgLi4uKQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDog\
ImFkbWludXNlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0\
CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZpY2VzCiAgICAtIG5hbWU6\
IGluZnJhc3Zjc19hZG1fcHdkCiAgICAgIHRpdGxlOiBJbmZyYSBTZXJ2aWNlcyBBZG1pbiBQYXNz\
d29yZAogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gcGFzc3dvcmQgZm9yIGluZnJhc3RydWN0dXJl\
IHNlcnZpY2VzIChHb2dzLCBDaGUsIC4uLikKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1\
bHQ6ICJhZG1pbnB3ZCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0\
ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZpY2VzCiAgICAtIG5h\
bWU6IGluZnJhc3Zjc19nb2dzX3VzZXJfY291bnQKICAgICAgdGl0bGU6IE51bWJlciBvZiBnb2dz\
IHVzZXIgZm9yIHRoZSBsYWIKICAgICAgZGVzY3JpcHRpb246IFNldCB0aGUgbnVtYmVyIG9mIHVz\
ZXJzLCB0aGlzIHdpbGwgY3JlYXRlIGdvZ3MgdXNlcnMgd2l0aCBnaXQgcmVwb3MKICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICIyNSIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNl\
cnZpY2VzCgogICAgICAK"


COPY playbooks /opt/apb/actions
RUN yum install -y python-pip && yum clean all && pip install jmespath
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
